
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Output Variation Excel File</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .status-pass { color: green; }
        .status-warning { color: orange; }
        .status-fail { color: red; }
    </style>
</head>
<body class="container mt-5">
    <h3>Upload Output Variation Excel File</h3>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Upload</button>
    <button onclick="downloadCSV()">Download CSV</button>
    <button onclick="downloadSavedCSV()">Download Saved CSV</button>
    <h5 class="mt-4">Evaluation Results:</h5>
    <table class="table table-bordered mt-3" id="resultsTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Variation</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
function uploadFile() {
    const input = document.getElementById('fileInput');
    if (!input.files[0]) return alert("Please choose a file first.");
    const formData = new FormData();
    formData.append("file", input.files[0]);
    fetch("https://back-end-wrxi.onrender.com/upload", {
        method: "POST",
        body: formData,
    })
    .then(response => response.json())
    .then(data => renderTable(data))
    .catch(err => alert("Upload failed: " + err));
}

function renderTable(data) {
    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";
    data.forEach(row => {
        const tr = document.createElement("tr");
        const variation = parseFloat(row.variation);
        let statusClass = "";
        if (variation >= -2 && variation <= 2) statusClass = "status-pass";
        else if ((variation > 2 && variation <= 3) || (variation < -2 && variation >= -3)) statusClass = "status-warning";
        else statusClass = "status-fail";

        tr.innerHTML = `
            <td>${row.date}</td>
            <td>${variation.toFixed(1)}%</td>
            <td class="${statusClass}">${row.status}</td>
        `;
        tbody.appendChild(tr);
    });
}

function downloadCSV() {
    fetch("https://back-end-wrxi.onrender.com/download_csv")
        .then(res => res.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "output_results.csv";
            document.body.appendChild(a);
            a.click();
            a.remove();
        });
}

function downloadSavedCSV() {
    fetch("https://back-end-wrxi.onrender.com/download_saved_csv")
        .then(res => res.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "saved_output_results.csv";
            document.body.appendChild(a);
            a.click();
            a.remove();
        });
}
</script>
</body>
</html>
