<script>
  document.querySelector("form").addEventListener("submit", async function (e) {
    e.preventDefault();
    
    const fileInput = document.querySelector("input[type='file']");
    const file = fileInput.files[0];

    if (!file) {
      alert("Please choose a file to upload.");
      return;
    }

    const formData = new FormData();
    formData.append("file", file);

    const response = await fetch("https://back-end-wrxi.onrender.com/upload", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if (response.ok) {
      // display result in a table
      let resultHtml = "<h2>Results</h2><table border='1'><tr><th>Date</th><th>Variation (%)</th><th>Status</th></tr>";
      data.forEach(row => {
        const color = row.within_tolerance ? "green" : "red";
        const status = row.within_tolerance ? "Within Tolerance" : "Out of Tolerance";
        resultHtml += `<tr>
                         <td>${row.date}</td>
                         <td>${row.variation}</td>
                         <td style="color:${color}">${status}</td>
                       </tr>`;
      });
      document.body.innerHTML += resultHtml;
    } else {
      alert("Error uploading file: " + data.error);
    }
  });
</script>
