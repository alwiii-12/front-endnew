<script>
        // ... (Firebase config, auth, db, allUsersData, DOM element consts) ...

        // --- GLOBAL HELPER FUNCTIONS (like showLoader, hideLoader, logout) ---
        function showLoader(){ /* ... */ }
        function hideLoader(){ /* ... */ }
        function logout(){ /* ... */ }

        // --- USER MANAGEMENT FUNCTIONS (Existing ones, also in global scope) ---
        async function loadAllUsers(){ /* ... */ }
        function populateMainUserFilters(){ /* ... */ }
        function renderUsers(usersToRender){ /* ... */ }
        function filterUsers(){ /* ... */ }
        async function updateUserStatus(uid, newStatus){ /* ... */ }
        function openEditModal(uid){ /* ... */ }
        function closeEditModal(){ /* ... */ }
        async function saveUserChanges(){ /* ... */ }

        // --- NEW: HOSPITAL QA DATA ACCESS FUNCTIONS (MOVE THESE HERE) ---
        function populateHospitalDataFilters() { /* ... */ } // Move this function definition here

        async function loadHospitalQaData() { /* ... */ } // MOVE THIS FUNCTION DEFINITION HERE

        function renderHospitalQaDataTable(data, year, month) { /* ... */ } // MOVE THIS FUNCTION DEFINITION HERE


        // --- DOMContentLoaded Listener (This block should now only contain event listeners and initial calls) ---
        document.addEventListener('DOMContentLoaded', async () => { // Keep async here
            // Basic check to prevent non-admins from directly accessing this page
            // auth.onAuthStateChanged moved here (or just keep it wrapping your main logic if preferred)
            auth.onAuthStateChanged(async user => {
                if (!user) { // No user logged in
                    window.location.href = "login.html";
                } else {
                    const userRole = localStorage.getItem("userRole");
                    const userStatus = localStorage.getItem("userStatus");

                    if (userRole === "Admin" && userStatus === "active") {
                        await loadAllUsers(); // Load all users and populate main filters
                        populateHospitalDataFilters(); // Populate new hospital data section filters
                    } else {
                        alert("Access Denied: You are not authorized to view this page or your account is not active.");
                        logout();
                    }
                }
            });
        });

    </script>
